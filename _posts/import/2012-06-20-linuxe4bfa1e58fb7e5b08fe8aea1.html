---
author: liwenxiang
comments: true
date: 2012-06-20 06:37:03+00:00
layout: post
slug: linux%e4%bf%a1%e5%8f%b7%e5%b0%8f%e8%ae%a1
title: linux信号小计（zz）
wordpress_id: 212
categories:
- 操作系统
- 转载
tags:
- linux
- 信号
---

<h2>1  信号本质</h2>
软中断信号（signal，又简称为信号）用来通知进程发生了异步事件。在软件层次上是对中断机制的一种模拟，在原理上，一个进程收到一个信号与处理器收到一个中断请求可以说是一样的。信号是进程间通信机制中唯一的异步通信机制，一个进程不必通过任何操作来等待信号的到达，事实上，进程也不知道信号到底什么时候到达。进程之间可以互相通过系统调用kill发送软中断信号。内核也可以因为内部事件而给进程发送信号，通知进程发生了某个事件。信号机制除了基本通知功能外，还可以传递附加信息。

收到信号的进程对各种信号有不同的处理方法。处理方法可以分为三类：

第一种是类似中断的处理程序，对于需要处理的信号，进程可以指定处理函数，由该函数来处理。

第二种方法是，忽略某个信号，对该信号不做任何处理，就象未发生过一样。

第三种方法是，对该信号的处理保留系统的默认值，这种缺省操作，对大部分的信号的缺省操作是使得进程终止。进程通过系统调用signal来指定进程对某个信号的处理行为。

<!--more-->
<div>
<div id="shareBody">
<h2>2  信号处理流程</h2>
对于一个完整的信号生命周期(从信号发送到相应的处理函数执行完毕)来说，可以分为三个阶段：

信号诞生

信号在进程中注册

信号的执行和注销
<h3> 2.1 信号诞生</h3>
信号事件的发生有两个来源：硬件来源(比如我们按下了键盘或者其它硬件故障)；软件来源，最常用发送信号的系统函数是kill, raise, alarm和setitimer以及sigqueue函数，软件来源还包括一些非法运算等操作。
<h3> 2.2 信号在目标进程中注册</h3>
<span style="color: #ff0000;">在进程表的表项中有一个软中断信号域，该域中每一位对应一个</span><span style="color: #ff0000;">信号。内核给一个进程发送软中断信号的方法，是在进</span><span style="color: #ff0000;">程所在的进程表项的信号域设置对应于该信号的位</span>。如果信号发送给一个正在睡眠的进程，如果进程睡眠在可被中断的优先级上，则唤醒进程；否则仅设置进程表中信号域相应的位，而不唤醒进程。如果发送给一个处于可运行状态的进程，则只置相应的域即可。
<h3>2.3 信号的执行和注销</h3>
内核处理一个进程收到的软中断信号是在该进程的上下文中，因此，进程必须处于运行状态。<span style="color: #ff0000;">当其由于被信号唤醒或者正常调度重新获得CPU时，在其从内核空间返回到用户空间时会检测是否有信号等待处理</span>。如果存在未决信号等待处理且该信号没有被进程阻塞，则在运行相应的信号处理函数前，进程会把信号在未决信号链中占有的结构卸掉。

<span style="color: #ff0000;">内核处理一个进程收到的信号的时机是在一个进程从内核态返回用户态时</span>。所以，当一个进程在内核态下运行时，软中断信号并不立即起作用，要等到将返回用户态时才处理。<span style="color: #ff0000;">进程只有处理完信号才会返回用户态，进程在用户态下不会有未处理完的信号。</span>

处理信号有三种类型：进程接收到信号后退出；进程忽略该信号；进程收到信号后执行用户设定用系统调用signal的函数。当进程接收到一个它忽略的信号时，进程丢弃该信号，就象没有收到该信号似的继续运行。<span style="color: #ff0000;">如果进程收到一个要捕捉的信号，那么进程从内核态返回用户态时执行用户定义的函数。而且执行用户定义的函数的方法很巧妙，内核是在用户栈上创建一个新的层，该层中将返回地址的值设置成用户定义的处理函数的地址，这样进程从内核返回弹出栈顶时就返回到用户定义的函数处，从函数返回再弹出栈顶时，才返回原先进入内核的地方</span>。这样做的原因是用户定义的处理函数不能且不允许在内核态下执行（如果用户定义的函数在内核态下运行的话，用户就可以获得任何权限）。

<span style="color: #ff0000;">收到信号或者调度到了CPU，从内核态返回到用户态的时候才会检查是否有信号处理</span>

&nbsp;

有缩减，原文链接

<a href="http://blog.renren.com/share/239079088/4329558663">http://blog.renren.com/share/239079088/4329558663</a>

</div>
</div>